name: Docker Image Sync to Aliyun Registry

on:
  push:
    paths:
      - 'images.yaml'

env:
  REGISTRY: ${{ secrets.REGISTRY }}
  NAMESPACE: ${{ secrets.REGISTRY_USER }}

jobs:
  sync-images:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Code
        uses: actions/checkout@v2

      - name: Set Docker Buildx
        uses: docker/setup-buildx-action@v1

      - name: Log in to Aliyun registry
        uses: docker/login-action@v1
        with:
          mode: login
          registry: ${{ secrets.REGISTRY }}  # Aliyun镜像仓库地址
          username: ${{ secrets.REGISTRY_USER }}  # Aliyun镜像仓库username
          password: ${{ secrets.REGISTRY_PASSWORD }} # Aliyun镜像仓库password

      - name: Read and Push Images 
        run: chmod +x ./app && ./app 
