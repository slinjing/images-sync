name: Docker Image CI
 
on:
  push:
    branches: [ main ]
    paths:
    - 'images.yaml'
 
jobs:
  build-and-push-image:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v2
 
    - name: Login to Aliyun Container Registry
      uses: docker/login-action@v1
      with:
        mode: login
        registry: ${{ secrets.REGISTRY }}  
        username: ${{ secrets.REGISTRY_USER }} 
        password: ${{ secrets.REGISTRY_PASSWORD }} 
 
    - name: Push Docker image
      run: chmod +x ./app && ./app 
      env:
        REGISTRY: ${{ secrets.REGISTRY }}
        NAMESPACE: ${{ secrets.REGISTRY_USER }}
